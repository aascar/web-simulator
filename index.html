<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Online Interactive HTML | CSS | JavaScript Editor</title>
    <meta name="description" content="Online fast and interactive editor for HTML, CSS and JavaScript.">
    <meta name="keywords" content="html editor, css editor, js editor, javascript editor, html, css, javascript, js, web editor, online editor, fast editor, web ide, ide">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <style type="text/css">
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #CCC;
        }
        ::-webkit-scrollbar-thumb {
            background: #999;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #888;
        }
        .editor {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            min-height: 50vh;
        }
        .controls>span{
            padding: 8px;
            color: lightgray;
        }
        .col-sm:hover .controls>span {
            display: none;
        }

    </style>
</head>
<body style="width: 100%;height: 100%; overflow: hidden">
<section>
    <iframe style="width:100%; height: 50vh; overflow: hidden; border-width: 0"></iframe>
</section>
<div class="container-fluid">
    <div class="row">
        <div class="col-sm">
            <div class="controls" style="position: absolute;z-index: 10; right: 0;">
                <span>HTML</span>
            </div>
            <div class="editor" id="html-editor"></div>
        </div>
        <div class="col-sm">
            <div class="controls" style="position: absolute;z-index: 10; right: 0;">
                <span>CSS</span>
            </div>
            <div class="editor" id="css-editor"></div>
        </div>
        <div class="col-sm">
            <div class="controls" style="position: absolute;z-index: 10; right: 0;">
                <span id="js-title">JavaScript</span>
                <button style="background: green; color: whitesmoke; display: none" onclick="renderDOMToIFrame(true)">Run</button>
            </div>
            <div class="editor" id="js-editor"></div>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.1/ace.js"></script>
<script>
    var languages = ["html", "css", "js"];
    var theme = localStorage.getItem("theme") || "monokai";
    var defaultTheme = "ace/theme/" + ( theme && theme.length > 0 ? theme : 'monokai' );
    var defaultHTML = '<!DOCTYPE html>\n' +
        '<html>\n' +
        '<head>\n' +
        '  <meta charset="UTF-8">\n' +
        '  <meta name="viewport" content="width=device-width">\n' +
        '  <title>Title</title>\n' +
        '</head>\n' +
        '<body>\n' +
        '</body>\n' +
        '</html>';

    var htmlObject = document.createElement('div'); //dummy element

    function DOM(html, css, js) {
        this.html = html;
        this.css = css;
        this.js = js;
        this._DOM = document.createElement('html');
        this.head = document.createElement('head');
        this.body = document.createElement('body');
        this.style = document.createElement('style');
        this.script = document.createElement('script');
        this.head.appendChild(this.style);
        this._DOM.appendChild(this.head);
        this._DOM.appendChild(this.body);
        this.arrangeAll();
    }

    DOM.prototype.arrangeAll = function(){
        this.style.innerHTML = this.css;
        this.script.innerHTML = this.js;
        this.body.innerHTML = this.html;
        this.body.appendChild(this.script);
    };

    DOM.prototype.setCSS = function (css) {
        this.css = css;
        this.style.innerHTML = css;
    };

    DOM.prototype.setHTML = function (html) {
        this.html = html;
        this.arrangeAll();
    };

    DOM.prototype.setJS = function (js) {
        this.js = js;
        this.script.innerHTML = js;
    };

    DOM.prototype.set = function (key, value) {
        this[key] = [value];
        switch (key) {
            case 'html':
                this.setHTML(value);
                break;
            case 'css':
                this.setCSS(value);
                break;
            case 'js':
                this.setJS(value);
                break;
            default:
        }
    };

    DOM.prototype.getDOMString = function () {
        htmlObject.appendChild(this._DOM);
        return htmlObject.innerHTML;
    };

    var _DOM = new DOM(
        localStorage.getItem(languages[0]),
        localStorage.getItem(languages[1]),
        localStorage.getItem(languages[2])
    );

    var iframe = document.querySelector("iframe");
    var runWithJSButton = document.querySelector('button');
    var jsTitle = document.querySelector('#js-title');

    var defaultCodes = {
        html: defaultHTML,
        css: '/*CSS*/',
        js: '//JavaScript'
    };
    //configure editors
    languages.forEach(function (language) {
        var editor = ace.edit(language + "-editor", {
            mode: "ace/mode/" + (language === 'js' ? 'javascript' : language),
            theme: defaultTheme
        });
        editor.setValue(localStorage.getItem(language) || defaultCodes[language]);
        editor.session.on('change', function(delta) {
            var value = editor.getValue();
            localStorage.setItem(language, value);
            _DOM.set(language, value);
            if(language !== 'js'){
                renderDOMToIFrame();
            }else{
                runWithJSButton.style.display = 'block';
                jsTitle.style.display = 'none';
            }
        });
    });

    function renderDOMToIFrame(runJS){
        iframe.setAttribute('srcdoc', _DOM.getDOMString());
        if(runJS){
            runWithJSButton.style.display = 'none';
            jsTitle.style.display = 'block';
        }
    }
    renderDOMToIFrame();
</script>
</body>
</html>